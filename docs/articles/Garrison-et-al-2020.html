<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A walkthrough of basic package features and the components of a CPA">
<title>Garrison et al. 2020 • jlmerclusterperm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Atkinson_Hyperlegible-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Garrison et al. 2020">
<meta property="og:description" content="A walkthrough of basic package features and the components of a CPA">
<meta property="og:image" content="https://yjunechoe.github.io/jlmerclusterperm/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jlmerclusterperm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/jlmerclusterperm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Topics</h6>
    <a class="dropdown-item" href="../articles/tidying-output.html">Tidying output</a>
    <a class="dropdown-item" href="../articles/julia-interface.html">Julia interface</a>
    <a class="dropdown-item" href="../articles/reproducibility.html">Reproducibility</a>
    <a class="dropdown-item" href="../articles/asynchronous-cpa.html">Asynchronous CPA</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Case Studies</h6>
    <a class="dropdown-item" href="../articles/Garrison-et-al-2020.html">Garrison et al. 2020</a>
    <a class="dropdown-item" href="../articles/Geller-et-al-2020.html">Geller et al. 2020</a>
    <a class="dropdown-item" href="../articles/deCarvalho-et-al-2021.html">de Carvalho et al. 2021</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/yjunechoe/jlmerclusterperm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Garrison et al. 2020</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yjunechoe/jlmerclusterperm/blob/HEAD/vignettes/articles/Garrison-et-al-2020.Rmd" class="external-link"><code>vignettes/articles/Garrison-et-al-2020.Rmd</code></a></small>
      <div class="d-none name"><code>Garrison-et-al-2020.Rmd</code></div>
    </div>

    
    
<p>This tutorial is a walkthrough of basic package features for
conducting CPA and the components of a CPA.</p>
<p>See more tutorials and vignettes on the <a href="https://yjunechoe.github.io/jlmerclusterperm/articles">Articles</a>
page.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The data comes from an eye-tracking study by <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7456569/" class="external-link">Garrison,
Baudet, Breitfield, Aberman, &amp; Bergelson (2020)</a> “Familiarity
plays a small role in noun comprehension at 12-18 months”, by way of the
<a href="https://langcog.github.io/peekbank-website/" class="external-link">peekbankr</a>
corpus package.</p>
<p>The original study used a growth curve model to analyze children’s
looks to an object when it was <strong>familiar</strong> (“own”)
vs. unfamiliar (“other”) at different <strong>ages</strong>
(median-split into “younger” and “older” groups). We will not be
replicating that specific analysis here.</p>
<p>Instead, we will follow <a href="https://kvonholzen.github.io/Macquarie_Presentation_buddy.html" class="external-link">Katie
Von Holzen’s tutorial</a> which used this dataset to conduct a simpler,
cluster-based permutation analysis (CPA) of differences between the two
age groups in the proportion of looks to the target. The tutorial used
the <a href="http://www.eyetracking-r.com/" class="external-link">eyetrackingR</a> package for
both <a href="http://www.eyetracking-r.com/vignettes/preparing_your_data" class="external-link">data
preparation</a> and <a href="http://www.eyetracking-r.com/vignettes/divergence" class="external-link">CPA</a>, but
this vignette will use <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> and
<code>jlmerclusterperm</code> for those tasks, respectively.</p>
<p>The following set-up code reads in the data and prepares it for
analysis:</p>
<details><summary>
Data preparation code
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"langcog/peekbankr"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/langcog/peekbankr" class="external-link">peekbankr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load data</span></span>
<span><span class="va">aoi_timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/peekbankr/man/get_aoi_timepoints.html" class="external-link">get_aoi_timepoints</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"garrison_bergelson_2020"</span><span class="op">)</span></span>
<span><span class="va">administrations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/peekbankr/man/get_administrations.html" class="external-link">get_administrations</a></span><span class="op">(</span>dataset_name <span class="op">=</span> <span class="st">"garrison_bergelson_2020"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pre-processing</span></span>
<span><span class="co">## Filter for age groups of interest</span></span>
<span><span class="va">ps_data</span> <span class="op">&lt;-</span> <span class="va">aoi_timepoints</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">administrations</span>, by <span class="op">=</span> <span class="st">"administration_id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/between.html" class="external-link">between</a></span><span class="op">(</span><span class="va">age</span>, <span class="fl">14</span>, <span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_binned <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">14</span>, <span class="st">"Younger"</span>, <span class="st">"Older"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Filter for time window of interest</span></span>
<span><span class="va">ts_window</span> <span class="op">&lt;-</span> <span class="va">ps_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">t_norm</span> <span class="op">&gt;=</span> <span class="fl">0</span>, <span class="va">t_norm</span> <span class="op">&lt;</span> <span class="fl">4000</span><span class="op">)</span></span>
<span><span class="co">## Identify trials to exclude (trackloss in &gt;25% of samples)</span></span>
<span><span class="va">to_exclude</span> <span class="op">&lt;-</span> <span class="va">ts_window</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">trial_id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">aoi</span> <span class="op">==</span> <span class="st">"missing"</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prop</span> <span class="op">&gt;</span> <span class="fl">0.25</span><span class="op">)</span></span>
<span><span class="co">## Exclude disqualifying trials and keep information relevant for CPA</span></span>
<span><span class="va">ts_data</span> <span class="op">&lt;-</span> <span class="va">ts_window</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">to_exclude</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subject_id"</span>, <span class="st">"trial_id"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    target <span class="op">=</span> <span class="va">aoi</span> <span class="op">==</span> <span class="st">"target"</span>,</span>
<span>    missing <span class="op">=</span> <span class="va">aoi</span> <span class="op">==</span> <span class="st">"missing"</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age_binned</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Younger"</span>, <span class="st">"Older"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">age</span>, <span class="va">trial_id</span>, time <span class="op">=</span> <span class="va">t_norm</span>, <span class="va">target</span>, <span class="va">missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data of subject mean proportions of fixations to target</span></span>
<span><span class="va">ts_data_agg</span> <span class="op">&lt;-</span> <span class="va">ts_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">age</span>, <span class="va">time</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">missing</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data of trial-level fixations to target (0s and 1s)</span></span>
<span><span class="va">ts_data_trials</span> <span class="op">&lt;-</span> <span class="va">ts_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">missing</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">age</span>, <span class="va">trial_id</span>, <span class="va">time</span>, <span class="va">target</span><span class="op">)</span></span></code></pre></div>
</details><p>The data <code>ts_data_agg</code> that we’ll use to replicate the
tutorial has just 4 columns which are relevant for the
cluster-permutation analysis:</p>
<ul>
<li>
<code>subject_id</code>: Unique identifier for subjects</li>
<li>
<code>age</code>: A between-participant factor variable
(<code>"Younger"</code>, <code>"Older"</code>)</li>
<li>
<code>time</code>: A continuous measure of time from 0-3975ms at
25ms intervals</li>
<li>
<code>prop</code>: A by-subject proportion of looks to the target
object</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_data_agg</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,560 × 4</span></span></span>
<span><span class="co">#&gt;    subject_id age    time  prop</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>       <span style="text-decoration: underline;">1</span>413 Older     0 0.7  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>       <span style="text-decoration: underline;">1</span>413 Older    25 0.733</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>       <span style="text-decoration: underline;">1</span>413 Older    50 0.7  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>       <span style="text-decoration: underline;">1</span>413 Older    75 0.7  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>       <span style="text-decoration: underline;">1</span>413 Older   100 0.677</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>       <span style="text-decoration: underline;">1</span>413 Older   125 0.677</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>       <span style="text-decoration: underline;">1</span>413 Older   150 0.645</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>       <span style="text-decoration: underline;">1</span>413 Older   175 0.645</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>       <span style="text-decoration: underline;">1</span>413 Older   200 0.581</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>       <span style="text-decoration: underline;">1</span>413 Older   225 0.548</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,550 more rows</span></span></span></code></pre></div>
<p>The following replicates the figure from the tutorial before it
introduces the cluster-permutation analysis:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">tutorial_fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ts_data_agg</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">prop</span>, color <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">0.1</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">age</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Prop. of Target Looks"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">.5</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">tutorial_fig</span></span></code></pre></div>
<p><img src="Garrison-et-al-2020_files/figure-html/tutorial-fig-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="outline">Outline<a class="anchor" aria-label="anchor" href="#outline"></a>
</h2>
<p>This case study vignette showcases four features of doing a CPA with
<code>jlmerclusterperm</code>:</p>
<ol style="list-style-type: upper-alpha">
<li><p>Prepping data for CPA using
<code><a href="../reference/make_jlmer_spec.html">make_jlmer_spec()</a></code></p></li>
<li><p>CPA in one go with <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code></p></li>
<li><p>A modular, step-by-step approach to CPA</p></li>
<li><p>Using logistic regression over trial-level data of 1s and
0s</p></li>
</ol>
<p>Load the package and start the Julia instance with
<code><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup()</a></code> before proceeding.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-prepping-a-specification-object">A) Prepping a specification object<a class="anchor" aria-label="anchor" href="#a-prepping-a-specification-object"></a>
</h2>
<p>Conducting a cluster-based permutation analysis in
<code>jlmerclusterm</code> starts with creating a special
<strong>specification object</strong>, which compiles information
necessary for a CPA.</p>
<p>The function <code><a href="../reference/make_jlmer_spec.html">make_jlmer_spec()</a></code> returns the specification
object of class <code>&lt;jlmer_spec&gt;</code> and minimally requires
two arguments:</p>
<ul>
<li>
<code>formula</code>: An R regression model formula</li>
<li>
<code>data</code>: A data frame</li>
</ul>
<p>For example, to model <code>prop</code> using <code>age</code> as a
predictor for the <code>ts_data_agg</code> data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">prop</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">ts_data_agg</span><span class="op">)</span></span>
<span><span class="va">simple_spec</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">jlmer specification</span> ───────────────────────────────────────── <span style="color: #0000BB;">&lt;jlmer_spec&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Formula</span>: prop ~ 1 + ageOlder</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Predictors</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">age</span>: ageOlder</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Data</span>:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,560 × 2</span></span></span>
<span><span class="co">#&gt;    prop ageOlder</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.7          1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0.733        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0.7          1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,557 more rows</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>The printed display includes four pieces of information about the
specification object:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Formula</strong>: The model formula in Julia syntax.
Here, it looks similar to the formula we provided, but with the
contrasts “spelled out” (<code>age</code> becomes
<code>ageOlder</code>)</p></li>
<li><p><strong>Predictors</strong>: A list of predictors in the form of
( <em>original</em> : expanded ). In this case, there is one predictor
<code>age</code> which is expanded to <code>ageOlder</code> because it’s
treatment coded with “Younger” as the reference level.</p></li>
<li><p><strong>Groupings</strong>: These should be specified in the call
to <code><a href="../reference/make_jlmer_spec.html">make_jlmer_spec()</a></code>. They are empty for
<code>simple_spec</code> because we only provided the
<code>formula</code> and <code>data</code>.</p></li>
<li><p><strong>Data</strong>: A transformed dataframe whose columns are
terms in the expanded formula. Note that the default dummy coding has
been applied for the discrete variable <code>age</code> - it is now
<code>ageOlder</code> with 0 for “Younger” and 1 for “Older”.</p></li>
</ol>
<p>We start with this bare specification object because, while it lacks
some parts for a CPA, we can use this for
<code>jlmerclusterperm</code>’s simple interface to Julia regression
models.</p>
<p>The function <code><a href="../reference/jlmer.html">jlmer()</a></code> takes this specification object as
input and returns a Julia regression model. This model represents a
“global” model fitted over the entire data, collapsing across time.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_jmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jlmer.html">jlmer</a></span><span class="op">(</span><span class="va">simple_spec</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">global_jmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)   0.523    0.003<span style="text-decoration: underline;">87</span>     135.  0   <span style="color: #949494;"> </span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ageOlder      0.098<span style="text-decoration: underline;">4</span>   0.005<span style="text-decoration: underline;">48</span>      18.0 3.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-72</span></span></span></code></pre></div>
<p>This is equivalent to an <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> model with the same
specifications:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span> <span class="co"># for the `tidy()` method for `lm()`</span></span>
<span><span class="va">global_rmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">prop</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">ts_data_agg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">global_rmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)   0.523    0.003<span style="text-decoration: underline;">87</span>     135.  0   <span style="color: #949494;"> </span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ageOlder      0.098<span style="text-decoration: underline;">4</span>   0.005<span style="text-decoration: underline;">48</span>      18.0 4.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-68</span></span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>We raise this tangent on <code><a href="../reference/jlmer.html">jlmer()</a></code> because we recommend
sanity-checking the design and output of a global model prior to using
the same model specifications for a CPA. Because regression models are
fit in Julia “under the hood”, you want to make sure that the output is
comparable to what you would expect in R. The global model can also tell
you the upper bound for model complexity. For example, if the global
model has singular fit, the time-wise models fitted to subsets of the
data likely will do too.</p>
</div>
<p>Functions for CPA also take a <code>&lt;jlmer_spec&gt;</code> object
but require information about time (to calculate time-wise statistics)
and subject/trial (for bootstrapped permutation). The
<code>ts_data_agg</code> data does not have trial-level information
because it has been summarized by subject, so we just leave that
out.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_data_agg_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">prop</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">ts_data_agg</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject_id"</span>, time <span class="op">=</span> <span class="st">"time"</span>,</span>
<span>  trial <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># This is the default value</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ts_data_agg_spec</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">jlmer specification</span> ───────────────────────────────────────── <span style="color: #0000BB;">&lt;jlmer_spec&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Formula</span>: prop ~ 1 + ageOlder</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Predictors</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">age</span>: ageOlder</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Groupings</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Subject</span>: subject_id</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Trial</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Time</span>: time</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Data</span>:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,560 × 4</span></span></span>
<span><span class="co">#&gt;    prop ageOlder subject_id  time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 0.7          1       <span style="text-decoration: underline;">1</span>413     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 0.733        1       <span style="text-decoration: underline;">1</span>413    25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0.7          1       <span style="text-decoration: underline;">1</span>413    50</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,557 more rows</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>The <code>trial</code> argument can be omitted from the
<code>&lt;jlmer_spec&gt;</code> object only if each time sample/bin is
uniquely identified by subject. Otherwise, <code>trial</code> should be
a column in the data that uniquely identifies each time values within
subject (for example, a column for items in a counterbalanced designed
where participant sees every item in only one of its variants).</p>
</div>
</div>
<div class="section level2">
<h2 id="b-cpa-with-clusterpermute">B) CPA with <code>clusterpermute()</code><a class="anchor" aria-label="anchor" href="#b-cpa-with-clusterpermute"></a>
</h2>
<p>The <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> function runs a CPA in one go,
using information from a <code>&lt;jlmer_spec&gt;</code> object. In
addition to the specification object, you must also supply the (t-value)
threshold and the number of simulations to run:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPA_agg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">ts_data_agg_spec</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Suppress printing of progress for vignette</span></span>
<span><span class="op">)</span></span>
<span><span class="va">CPA_agg</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span> (n = 100)</span></span>
<span><span class="co">#&gt;   Mean (SD): -0.844 (29.71)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-46.664, 71.698]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 74.724 <span style="font-style: italic;">(p=0.0396)</span></span></span>
<span><span class="co">#&gt;   [2675, 2775]: 11.017 <span style="color: #B2B2B2; font-style: italic;">(p=0.4356)</span></span></span>
<span><span class="co">#&gt;   [3500, 3900]: 46.295 <span style="color: #B2B2B2; font-style: italic;">(p=0.0990)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>The result is a list of two elements:</p>
<ol style="list-style-type: decimal">
<li><p>A <code>&lt;null_cluster_dists&gt;</code> object which holds
information about the distribution of the bootstrapped cluster-mass
statistics from random permutations of the data:</p></li>
<li><p>An <code>&lt;empirical_clusters&gt;</code> object which holds
per-predictor information about the clusters detected, and their
p-values after significance testing against the null:</p></li>
</ol>
<p>The output is explained more in the next section, but for presented
purposes simply note that the results are very similar to that reported
in <a href="https://kvonholzen.github.io/Macquarie_Presentation_buddy.html" class="external-link">Katie
Von Holzen’s tutorial</a>, copied below.</p>
<pre><code><span><span class="co">#&gt; ## Summary of Clusters ======</span></span>
<span><span class="co">#&gt; ##   Cluster Direction SumStatistic StartTime EndTime Probability</span></span>
<span><span class="co">#&gt; ## 1       1  Positive    74.723687       850    1550       0.051</span></span>
<span><span class="co">#&gt; ## 2       2  Positive     6.905622      2725    2800       0.405</span></span>
<span><span class="co">#&gt; ## 3       3  Positive    46.294644      3500    3925       0.111</span></span></code></pre>
<p>The minor numerical differences are due to the stochastic nature of
the permutation test and because we’re comparing t-tests in R to
regression models in Julia.</p>
</div>
<div class="section level2">
<h2 id="c-a-step-by-step-approach">C) A step-by-step approach<a class="anchor" aria-label="anchor" href="#c-a-step-by-step-approach"></a>
</h2>
<p>The <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> function showcased above consists
of five parts, all of which are also standalone functions in the
package:</p>
<ul>
<li><code><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics()</a></code></li>
<li><code><a href="../reference/extract_empirical_clusters.html">extract_empirical_clusters()</a></code></li>
<li><code><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics()</a></code></li>
<li><code><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists()</a></code></li>
<li><code><a href="../reference/calculate_clusters_pvalues.html">calculate_clusters_pvalues()</a></code></li>
</ul>
<p>These functions correspond to the algorithmic steps of the
statistical test. While <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> obviates the need
to think about these individual components, knowing them gives you a
greater flexibility over the procedure.</p>
<p>This section walks through the CPA step-by-step using these
functions.</p>
<div class="section level3">
<h3 id="empirical-clusters">1) Empirical clusters<a class="anchor" aria-label="anchor" href="#empirical-clusters"></a>
</h3>
<p>The <code><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics()</a></code> function takes a
<code>&lt;jlmer_spec&gt;</code> object and returns the <strong>timewise
statistics</strong> in the form of a matrix where each row is a
predictor and each column is a time point:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_statistics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics</a></span><span class="op">(</span><span class="va">ts_data_agg_spec</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">empirical_statistics</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   1 160</span></span>
<span><span class="va">empirical_statistics</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="co"># First 5 time points</span></span>
<span><span class="co">#&gt;           Time</span></span>
<span><span class="co">#&gt; Predictor          0         25         50         75        100</span></span>
<span><span class="co">#&gt;   ageOlder 0.1166025 -0.1273179 -0.2387778 -0.4022095 -0.2804397</span></span></code></pre></div>
<p>For example we see that at 25ms, the t-value for <code>age</code> is
-0.127. This is consistent with the figure from the tutorial replicated
above which show the two lines mostly overlapping.</p>
<p>Just for demonstration purposes, we use <code><a href="../reference/to_jlmer.html">to_jlmer()</a></code>
quickly fit a model using the same formula to just the data at 25ms. We
see that the t-value for <code>age</code> from this model is exactly the
same as what we saw above:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/to_jlmer.html">to_jlmer</a></span><span class="op">(</span><span class="va">prop</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ts_data_agg</span>, <span class="va">time</span> <span class="op">==</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"ageOlder"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.1273179</span></span></code></pre></div>
<p>We then construct the <strong>empirical clusters</strong> from the
timewise statistics. Clusters are defined as a continuous span of
statistics of the same sign whose absolute value passes a certain
threshold. The <code><a href="../reference/extract_empirical_clusters.html">extract_empirical_clusters()</a></code> function takes
the timewise statistics and a threshold to do just that:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_empirical_clusters.html">extract_empirical_clusters</a></span><span class="op">(</span><span class="va">empirical_statistics</span>, threshold <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 74.724</span></span>
<span><span class="co">#&gt;   [2675, 2775]: 11.017</span></span>
<span><span class="co">#&gt;   [3500, 3900]: 46.295</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>With a t-value threshold of 2, we detect three clusters in the data
for the main effect of age (<code>ageOlder</code>). The numbers in
brackets show the span of the cluster and the number to the right show
the sum of the t-values in the cluster (a.k.a. the <strong>cluster-mass
statistic</strong>).</p>
<p>We can collect this <code>&lt;empirical_clusters&gt;</code> object as
a data frame with <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_clusters_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">empirical_clusters</span><span class="op">)</span></span>
<span><span class="va">empirical_clusters_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">#&gt;   predictor id    start   end length sum_statistic</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ageOlder  1       850  <span style="text-decoration: underline;">1</span>525     28          74.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ageOlder  2      <span style="text-decoration: underline;">2</span>675  <span style="text-decoration: underline;">2</span>775      5          11.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ageOlder  3      <span style="text-decoration: underline;">3</span>500  <span style="text-decoration: underline;">3</span>900     17          46.3</span></span></code></pre></div>
<p>And add it to the figure above:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tutorial_fig</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">start</span>, xend <span class="op">=</span> <span class="va">end</span>, y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">empirical_clusters_df</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, x <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="op">(</span><span class="va">end</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="va">id</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">empirical_clusters_df</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Garrison-et-al-2020_files/figure-html/tutorial_fig-eclusters-1.png" width="100%"></p>
<p>But by this point we do not know whether the size of the clusters
that we observe are (un)likely to emerge by chance. To calculate this
probability, we need to simulate the null distribution.</p>
</div>
<div class="section level3">
<h3 id="null-distribution">2) Null distribution<a class="anchor" aria-label="anchor" href="#null-distribution"></a>
</h3>
<p>The <code><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics()</a></code> function takes a
specification object and the number of bootstrapped permutation of the
data to simulate (via the <code>nsim</code> argument).</p>
<p>The returned 3-dimensional array is like the output of
<code><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics()</a></code> except with an additional
dimension representing each simulation:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">null_statistics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics</a></span><span class="op">(</span><span class="va">ts_data_agg_spec</span>, nsim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co"># simulation by time by predictor</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">null_statistics</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100 160   1</span></span>
<span><span class="co"># First 5 time points of the first three simulations</span></span>
<span><span class="va">null_statistics</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="co">#&gt; , , Predictor = ageOlder</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Time</span></span>
<span><span class="co">#&gt; Sim            0        25        50        75        100</span></span>
<span><span class="co">#&gt;   001 -0.1037696 0.1387838 0.4583545 0.4337538 0.69136613</span></span>
<span><span class="co">#&gt;   002  1.4358330 1.2745381 1.2985888 0.9111359 1.16401311</span></span>
<span><span class="co">#&gt;   003  0.2545470 0.3885999 0.3374939 0.3200497 0.05603617</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>The permutation algorithm preserves the grouping structures of the
data as specified in the specification object. For example, when testing
a between-subject predictor like <code>age</code>, the age groups of
participants are random swapped while preserving the temporal structure
of the data.</p>
</div>
<p>The null distribution is a collection of the <em>largest</em>
cluster-mass statistic from each simulated data. If no clusters are
detected in a simulation, it contributes a cluster-mass of <em>zero</em>
to the null.</p>
<p>We use <code><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists()</a></code> to construct the
null distribution, using the same threshold value of 2 to allow for a
comparison with the empirical clusters:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">null_cluster_dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists</a></span><span class="op">(</span><span class="va">null_statistics</span>, threshold <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span> (n = 100)</span></span>
<span><span class="co">#&gt;   Mean (SD): -6.150 (40.29)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-114.564, 74.425]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>When printed, the returned <code>&lt;null_cluster_dists&gt;</code>
object shows summary statistics. You can use <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> to
collect the samples from the null into a data frame:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">null_cluster_dists_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">null_cluster_dists</span><span class="op">)</span></span>
<span><span class="va">null_cluster_dists_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 100 × 6</span></span></span>
<span><span class="co">#&gt;    predictor start   end length sum_statistic sim  </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    001  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    002  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ageOlder   <span style="text-decoration: underline;">2</span>175  <span style="text-decoration: underline;">2</span>225      3         -<span style="color: #BB0000;">6.37</span> 003  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    004  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ageOlder   <span style="text-decoration: underline;">3</span>425  <span style="text-decoration: underline;">3</span>475      3         -<span style="color: #BB0000;">6.67</span> 005  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    006  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    007  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    008  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ageOlder     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>          0    009  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ageOlder   <span style="text-decoration: underline;">1</span>525  <span style="text-decoration: underline;">2</span>475     39       -<span style="color: #BB0000;">114.</span>   010  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 90 more rows</span></span></span></code></pre></div>
<p>The null distribution can be plotted like so:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">null_cluster_dists_df</span><span class="op">$</span><span class="va">sum_statistic</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Null distribution of cluster-mass statistics"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="Garrison-et-al-2020_files/figure-html/plot-null_cluster_dists-1.png" width="100%"></p>
<p>Now all that is left is to test the probability of observing
cluster-mass statistics as extreme as that of the detected clusters in
<code>empirical_clusters</code>, using <code>null_cluster_dists</code>
as reference.</p>
</div>
<div class="section level3">
<h3 id="significance-test">3) Significance test<a class="anchor" aria-label="anchor" href="#significance-test"></a>
</h3>
<p>The <code><a href="../reference/calculate_clusters_pvalues.html">calculate_clusters_pvalues()</a></code> function computes the
p-value for each empirical cluster and returns an augmented
<code>&lt;empirical_clusters&gt;</code> object:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_clusters_tested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_clusters_pvalues.html">calculate_clusters_pvalues</a></span><span class="op">(</span><span class="va">empirical_clusters</span>, <span class="va">null_cluster_dists</span><span class="op">)</span></span>
<span><span class="va">empirical_clusters_tested</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 74.724 <span style="color: #B2B2B2; font-style: italic;">(p=0.1100)</span></span></span>
<span><span class="co">#&gt;   [2675, 2775]: 11.017 <span style="color: #B2B2B2; font-style: italic;">(p=0.4000)</span></span></span>
<span><span class="co">#&gt;   [3500, 3900]: 46.295 <span style="color: #B2B2B2; font-style: italic;">(p=0.1700)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>Again, the p-values are slightly different because the test is
stochastic. A <a href="https://yjunechoe.github.io/jlmerclusterperm/articles/reproducibility.html">separate
vignette</a> covers issues of replicability, seed, and rng.</p>
</div>
<p>When collected with <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>, the p-values are added as a
column:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">empirical_clusters_tested</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">#&gt;   predictor id    start   end length sum_statistic pvalue</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ageOlder  1       850  <span style="text-decoration: underline;">1</span>525     28          74.7   0.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ageOlder  2      <span style="text-decoration: underline;">2</span>675  <span style="text-decoration: underline;">2</span>775      5          11.0   0.4 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ageOlder  3      <span style="text-decoration: underline;">3</span>500  <span style="text-decoration: underline;">3</span>900     17          46.3   0.17</span></span></code></pre></div>
<p>Note that when reporting pvalues, it’s customary to add 1 to the
numerator and denominator. This is because the observed data, however
unlikely, is itself one particular arrangement (permutation) of the
data. This is controlled via the <code>add1</code> argument - it is
false by default in <code><a href="../reference/calculate_clusters_pvalues.html">calculate_clusters_pvalues()</a></code> but true
in <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calculate_clusters_pvalues.html">calculate_clusters_pvalues</a></span><span class="op">(</span><span class="va">empirical_clusters</span>, <span class="va">null_cluster_dists</span>, add1 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 74.724 <span style="color: #B2B2B2; font-style: italic;">(p=0.1188)</span></span></span>
<span><span class="co">#&gt;   [2675, 2775]: 11.017 <span style="color: #B2B2B2; font-style: italic;">(p=0.4059)</span></span></span>
<span><span class="co">#&gt;   [3500, 3900]: 46.295 <span style="color: #B2B2B2; font-style: italic;">(p=0.1782)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>We have now come full circle: the pvalue-augmented
<code>&lt;empirical_clusters&gt;</code> object, along with the
<code>&lt;null_cluster_dists&gt;</code> object, are also what the
<code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> function returned above.</p>
</div>
</div>
<div class="section level2">
<h2 id="d-as-logistic-regression">D) As logistic regression<a class="anchor" aria-label="anchor" href="#d-as-logistic-regression"></a>
</h2>
<div class="section level3">
<h3 id="aggregated-vs--trial-level-data">Aggregated vs. trial-level data<a class="anchor" aria-label="anchor" href="#aggregated-vs--trial-level-data"></a>
</h3>
<p>The data that we have been using so far is an <em>aggregated</em>
data which collapsed across trials within each subject. In other words,
there is exactly one measure of the <em>proportion</em> of looks to the
target per time point within subject:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ts_data_agg</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2560</span></span>
<span><span class="va">ts_data_agg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2560</span></span></code></pre></div>
<p>It is possible to also fit a <strong>logistic regression
model</strong> over the trial-level measure of “hits” (1s and 0s) on the
target area of interest. This un-aggregated, trial-level data comes from
the data preparation code at the top of this vignette.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_data_trials</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 62,466 × 5</span></span></span>
<span><span class="co">#&gt;    subject_id age   trial_id  time target</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659     0      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659    25      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659    50      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659    75      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659   100      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659   125      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659   150      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659   175      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659   200      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>       <span style="text-decoration: underline;">1</span>413 Older     <span style="text-decoration: underline;">2</span>659   225      1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 62,456 more rows</span></span></span></code></pre></div>
<p>To demonstrate the relationship between the two data sets:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>  <span class="va">ts_data_agg</span>,</span>
<span>  <span class="va">ts_data_trials</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">subject_id</span>, <span class="va">age</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">target</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The specification object for fitting logistic regression models to
the trial-level data requires two changes from the original:</p>
<ol style="list-style-type: decimal">
<li><p>The formula must predict the binary <code>target</code> variable,
instead of <code>prop</code></p></li>
<li><p>A <code>trial</code> grouping must be specified to uniquely
identify each time point within each subject</p></li>
</ol>
<p>The following is the appropriate <code>&lt;jlmer_spec&gt;</code>
object for a CPA using logistic regression:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_data_trial_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">target</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">ts_data_trials</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject_id"</span>, trial <span class="op">=</span> <span class="st">"trial_id"</span>, time <span class="op">=</span> <span class="st">"time"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ts_data_trial_spec</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">jlmer specification</span> ───────────────────────────────────────── <span style="color: #0000BB;">&lt;jlmer_spec&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Formula</span>: target ~ 1 + ageOlder</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Predictors</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">age</span>: ageOlder</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Groupings</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Subject</span>: subject_id</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Trial</span>: trial_id</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Time</span>: time</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Data</span>:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 62,466 × 5</span></span></span>
<span><span class="co">#&gt;   target ageOlder subject_id trial_id  time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1        1       <span style="text-decoration: underline;">1</span>413     <span style="text-decoration: underline;">2</span>659     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1        1       <span style="text-decoration: underline;">1</span>413     <span style="text-decoration: underline;">2</span>659    25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1        1       <span style="text-decoration: underline;">1</span>413     <span style="text-decoration: underline;">2</span>659    50</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 62,463 more rows</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>Again, we sanity check with a global model using
<code>family = "binomial"</code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_jmod_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jlmer.html">jlmer</a></span><span class="op">(</span><span class="va">ts_data_trial_spec</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">global_jmod_binom</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   term        estimate std.error statistic   p.value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)    0.113    0.012<span style="text-decoration: underline;">1</span>      9.31 1.24<span style="color: #949494;">e</span><span style="color: #BB0000;">- 20</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ageOlder       0.392    0.016<span style="text-decoration: underline;">4</span>     23.9  1.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-126</span></span></span></code></pre></div>
<p>The estimates are similar to that of <code>global_jmod</code> in the
previous section, but in log-odds.</p>
</div>
<div class="section level3">
<h3 id="repeating-the-cpa-with-logistic-regression">Repeating the CPA with logistic regression<a class="anchor" aria-label="anchor" href="#repeating-the-cpa-with-logistic-regression"></a>
</h3>
<p>We repeat the same procedure from above but use our new specification
object and set <code>family = "binomial"</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_statistics_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics</a></span><span class="op">(</span><span class="va">ts_data_trial_spec</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span><span class="va">empirical_clusters_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_empirical_clusters.html">extract_empirical_clusters</a></span><span class="op">(</span><span class="va">empirical_statistics_binom</span>, threshold <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">empirical_clusters_binom</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [650, 725]: 8.727</span></span>
<span><span class="co">#&gt;   [800, 1575]: 112.199</span></span>
<span><span class="co">#&gt;   [1775, 1875]: 12.764</span></span>
<span><span class="co">#&gt;   [2600, 2825]: 23.733</span></span>
<span><span class="co">#&gt;   [3475, 3975]: 62.714</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>Instead of 3 clusters, we now detect 5. We can annotate the detected
clusters on the time series data as we did above:</p>
<details><summary>
Plotting code
</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_clusters_binom_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">empirical_clusters_binom</span><span class="op">)</span></span>
<span><span class="va">tutorial_fig</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">start</span>, xend <span class="op">=</span> <span class="va">end</span>, y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">empirical_clusters_binom_df</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, x <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="op">(</span><span class="va">end</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="va">id</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">empirical_clusters_binom_df</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</details><p><img src="Garrison-et-al-2020_files/figure-html/tutorial_fig-eclusters_binom-1.png" width="100%"></p>
<p>The differences we see between the aggregated vs. trial-level data
here are completely expected and follow straightforwardly from the
following two facts:</p>
<ol style="list-style-type: decimal">
<li><p>The cluster-mass statistic is derived from the size of
<strong>t-values</strong> at each time point, not the <strong>effect
size</strong>. By virtue of the unaggregated <code>ts_data_trials</code>
data having more number of observations, the t-values are overall
<em>inflated</em> where there is a difference in means (we also see this
in the output of <code>global_jmod</code>
vs. <code>global_jmod_binom</code> as well).</p></li>
<li><p>Whereas the aggregated data reflects a <strong>complete
pooling</strong> over trial-level variation, the binomial model over
trial-level data performs <strong>no pooling</strong> and treats each
trial as independent. Thus, if a certain item in the experiment show an
<em>outlier</em> effect at one time point, for example, then that will
strongly influence the mass of any cluster spanning over that given time
point.</p></li>
</ol>
<p>The first issue (inflated statistics) is trivial and just takes a
matter of adjusting the threshold. In fact, this is good because by
“stretching out” the t-statistics, we get a higher <em>resolution</em>
for the shape of the timewise statistics. However. the second issue (no
pooling) is troubling because it can <em>warp</em> the fundamental shape
of the timewise statistics.</p>
<p>We diagnose these factors by visualizing the <strong>timewise
statistics</strong>. We also plot timewise statistics from the
aggregated data for comparison:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timewise_statistics_fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">statistic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"aggregated"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">empirical_statistics</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"trial-level"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">empirical_statistics_binom</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">timewise_statistics_fig</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">time</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">empirical_statistics_binom</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Garrison-et-al-2020_files/figure-html/timewise_statistics_fig-1.png" width="100%"></p>
<p>We see that the trial-level binomial model has overall inflated
t-values, as well as more pronounced “peaks” (specifically the maximum
at 1300ms). A middle-ground, <em>partial pooling</em> approaching using
mixed-effects models for CPA is showcased in other case study
vignettes.</p>
<p>For present purposes, we raise the threshold to a value (of
<code>2.8</code>) which gets us close to detecting at least the same
<em>largest</em> cluster from <code>empirical_statistics</code>,
spanning 850ms-1525ms:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_clusters_binom2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_empirical_clusters.html">extract_empirical_clusters</a></span><span class="op">(</span><span class="va">empirical_statistics_binom</span>, threshold <span class="op">=</span> <span class="fl">2.8</span><span class="op">)</span></span>
<span><span class="va">empirical_clusters_binom2</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2.8</span>) ──────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 102.450</span></span>
<span><span class="co">#&gt;   [3500, 3875]: 51.365</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>We run the cluster permutation test with this threshold for just the
largest cluster:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPA_trial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">ts_data_trial_spec</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">2.8</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  top_n <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Just test the largest cluster</span></span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Suppress printing of progress for vignette</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This gives us a pvalue for the cluster spanning from 850ms to 1525ms
that is similar to the one reported for the aggregated data:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPA_trial</span><span class="op">$</span><span class="va">empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2.8</span>) ──────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 102.450 <span style="font-style: italic;">(p=0.0297)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span></span>
<span><span class="va">CPA_agg</span><span class="op">$</span><span class="va">empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 74.724 <span style="font-style: italic;">(p=0.0396)</span></span></span>
<span><span class="co">#&gt;   [2675, 2775]: 11.017 <span style="color: #B2B2B2; font-style: italic;">(p=0.4356)</span></span></span>
<span><span class="co">#&gt;   [3500, 3900]: 46.295 <span style="color: #B2B2B2; font-style: italic;">(p=0.0990)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>These appear to converge at a higher <code>nsim</code> for this data
set. We also time the 1000-simulation runs to showcase the speed of
<code>jlmerclusterperm</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span>  <span class="va">CPA_agg_1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>    <span class="va">ts_data_agg_spec</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">1000</span>, top_n <span class="op">=</span> <span class="fl">1</span>, progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.27    0.58   17.53</span></span>
<span><span class="va">CPA_agg_1000</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span> (n = 1000)</span></span>
<span><span class="co">#&gt;   Mean (SD): 0.078 (40.29)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-76.748, 82.717]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 74.724 <span style="color: #B2B2B2; font-style: italic;">(p=0.0629)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span>  <span class="va">CPA_trial_1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>    <span class="va">ts_data_trial_spec</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"binomial"</span>, threshold <span class="op">=</span> <span class="fl">2.8</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">1000</span>, top_n <span class="op">=</span> <span class="fl">1</span>, progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.14    0.20   31.39</span></span>
<span><span class="va">CPA_trial_1000</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">2.8</span>) ──────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span> (n = 1000)</span></span>
<span><span class="co">#&gt;   Mean (SD): -0.045 (55.09)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-119.239, 125.506]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2.8</span>) ──────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ageOlder</span></span></span>
<span><span class="co">#&gt;   [850, 1525]: 102.450 <span style="color: #B2B2B2; font-style: italic;">(p=0.0689)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>Note the use <code><a href="../reference/julia_rng.html">set_rng_state()</a></code>, which makes the two CPAs
generate the same permutations of the observed data.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://yjunechoe.github.io" class="external-link">June Choe</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
