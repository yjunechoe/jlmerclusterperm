<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A walkthrough of t vs. chisq statistic in a (mixed-effects) CPA">
<title>Geller et al. 2020 • jlmerclusterperm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Atkinson_Hyperlegible-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Geller et al. 2020">
<meta property="og:description" content="A walkthrough of t vs. chisq statistic in a (mixed-effects) CPA">
<meta property="og:image" content="https://yjunechoe.github.io/jlmerclusterperm/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jlmerclusterperm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/jlmerclusterperm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Topics</h6>
    <a class="dropdown-item" href="../articles/tidying-output.html">Tidying output</a>
    <a class="dropdown-item" href="../articles/julia-interface.html">Julia interface</a>
    <a class="dropdown-item" href="../articles/reproducibility.html">Reproducibility</a>
    <a class="dropdown-item" href="../articles/asynchronous-cpa.html">Asynchronous CPA</a>
    <a class="dropdown-item" href="../articles/eyetrackingR-comparison.html">Comparison to eyetrackingR</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Case Studies</h6>
    <a class="dropdown-item" href="../articles/Garrison-et-al-2020.html">Garrison et al. 2020</a>
    <a class="dropdown-item" href="../articles/Geller-et-al-2020.html">Geller et al. 2020</a>
    <a class="dropdown-item" href="../articles/deCarvalho-et-al-2021.html">de Carvalho et al. 2021</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/yjunechoe/jlmerclusterperm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Geller et al. 2020</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yjunechoe/jlmerclusterperm/blob/HEAD/vignettes/articles/Geller-et-al-2020.Rmd" class="external-link"><code>vignettes/articles/Geller-et-al-2020.Rmd</code></a></small>
      <div class="d-none name"><code>Geller-et-al-2020.Rmd</code></div>
    </div>

    
    
<p>This tutorial is a walk through of the choice of t vs. chisq
statistic in a (mixed-effects) CPA.</p>
<p>See more tutorials and vignettes on the <a href="https://yjunechoe.github.io/jlmerclusterperm/articles">Articles</a>
page.</p>
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The data comes from a lexical decision task using pupilometry
(specifically, measure of pupil dilation) to study differences in
processing difficulty between <strong>print</strong>
vs. <strong>cursive</strong> script. The data is available as part of
the <a href="https://github.com/dmirman/gazer" class="external-link">gazer</a> package by <a href="https://link.springer.com/article/10.3758/s13428-020-01374-8" class="external-link">Geller,
Winn, Mahr, &amp; Mirman 2020</a>.</p>
<p>We will follow <a href="https://www.drjasongeller.com/blog/2020-gp-pup/" class="external-link">Jason Geller’s
tutorial</a> which used the <a href="https://github.com/dalejbarr/clusterperm/" class="external-link">clusterperm</a> package
to conduct a cluster-based permutation analysis (CPA) of differences in
pupil size between the print and cursive conditions.</p>
<p>The data from the package (<code>cursive_agg_data</code>) looks
slightly different from that used in the tutorial, so to ensure full
reproducibility we use the <a href="https://raw.githubusercontent.com/jgeller112/drjasongeller/main/content/blog/2020-07-10-CBPT/blog_data.csv" class="external-link">exact
data</a> that the tutorial used:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">cursive_agg_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/jgeller112/drjasongeller/main/content/blog/2020-07-10-CBPT/blog_data.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cursive_agg_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,184 × 5</span></span></span>
<span><span class="co">#&gt;        X subject script  timebins aggbaseline</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 10b.edf cursive        0      36.9  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 10b.edf cursive      100      27.5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 10b.edf cursive      200      19.6  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 10b.edf cursive      300      12.6  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 10b.edf cursive      400       5.60 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 10b.edf cursive      500       0.968</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 10b.edf cursive      600      -<span style="color: #BB0000;">5.98</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 10b.edf cursive      700      -<span style="color: #BB0000;">5.96</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 10b.edf cursive      800       3.01 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 10b.edf cursive      900      12.9  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,174 more rows</span></span></span></code></pre></div>
<p>The data comes prepared for this analysis out of the box. The
following columns are relevant for our analysis:</p>
<ul>
<li>
<code>subject</code>: Unique identifier for subjects</li>
<li>
<code>script</code>: A <strong>within-participant</strong> factor
variable (<code>"cursive"</code>, <code>"print"</code>)</li>
<li>
<code>time</code>: A continuous measure of time from 0-2500ms at
100ms intervals</li>
<li>
<code>aggbaseline</code>: The response variable representing
normalized (“baseline-corrected”) pupil size</li>
</ul>
<p>As the name of the <code>cusrive_agg_data</code> variable suggests,
the data has been aggregated within subject, collapsing across
trials.</p>
<p>The following reproduces the figure from the tutorial:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">script_fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cursive_agg_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">timebins</span>, <span class="va">aggbaseline</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">script</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"line"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">script_fig</span></span></code></pre></div>
<p><img src="Geller-et-al-2020_files/figure-html/script_fig-1.png" width="100%"></p>
<div class="callout" style="font-size:0.9em">
<p>For within-participant predictors like <code>script</code>, the
permutation algorithm will randomly swap the labels for condition
<em>between</em> the trials <em>within</em> each subject. This preserves
the temporal structure of the trial-level data (no swapping below the
trial-level grouping) as well as the subject-level grouping structure
(no swapping of trials across participants).</p>
</div>
</div>
<div class="section level2">
<h2 id="outline">Outline<a class="anchor" aria-label="anchor" href="#outline"></a>
</h2>
<p>This case study vignette showcases five features of doing a CPA with
<code>jlmerclusterperm</code>:</p>
<ol style="list-style-type: upper-alpha">
<li><p>Prepping data for CPA using
<code><a href="../reference/make_jlmer_spec.html">make_jlmer_spec()</a></code></p></li>
<li><p><code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> with default
<code>statistic = "t"</code></p></li>
<li><p>A comparison between “t” and “chisq”</p></li>
<li><p>Specifying random effects</p></li>
<li><p>Contrast coding</p></li>
</ol>
<p>Load the package and start the Julia instance with
<code><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup()</a></code> before proceeding.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-prepping-a-specification-object">A) Prepping a specification object<a class="anchor" aria-label="anchor" href="#a-prepping-a-specification-object"></a>
</h2>
<p>We start with a simple specification object to model
<code>aggbaseline</code> using <code>script</code> as a predictor for
the <code>script_fig</code> data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span>,</span>
<span>  data <span class="op">=</span> <span class="va">cursive_agg_data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">simple_spec</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">jlmer specification</span> ───────────────────────────────────────── <span style="color: #0000BB;">&lt;jlmer_spec&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Formula</span>: aggbaseline ~ 1 + scriptprint</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Predictors</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">script</span>: scriptprint</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Data</span>:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,184 × 2</span></span></span>
<span><span class="co">#&gt;   aggbaseline scriptprint</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        36.9           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        27.5           0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        19.6           0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,181 more rows</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>For a sanity check, we fit a global model to the data…</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/jlmer.html">jlmer</a></span><span class="op">(</span><span class="va">simple_spec</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Julia object of type StatsModels.TableRegressionModel&gt;</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;                 Coef.  Std. Error      z  Pr(&gt;|z|)  Lower 95%  Upper 95%</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; (Intercept)   46.7221     2.79622  16.71    &lt;1e-61    41.2417    52.2026</span></span>
<span><span class="co">#&gt; scriptprint  -10.2582     3.95445  -2.59    0.0095   -18.0088    -2.5076</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>…and check that it’s comparable to what we expect from
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span>, data <span class="op">=</span> <span class="va">cursive_agg_data</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co">#&gt;              Estimate Std. Error   t value     Pr(&gt;|t|)</span></span>
<span><span class="co">#&gt; (Intercept)  46.72214   2.796221 16.709029 4.512338e-59</span></span>
<span><span class="co">#&gt; scriptprint -10.25818   3.954454 -2.594083 9.547816e-03</span></span></code></pre></div>
<p>The <em>full</em> specification object for a CPA must also declare
the <strong>grouping structures</strong> present in the data. The rule
of thumb is that <strong>every observation (row) in the data must be
uniquely identified by a combination of columns for
<code>subject</code>, <code>trial</code>, and
<code>time</code></strong>. Because CPA is over a time series data
<code>time</code> must always be specified, and <code>subject</code>
must also always be specified for the permutation algorithm to respect
subject-level grouping of the data.</p>
<p>The <code>cursive_agg_data</code> data collapses across trials within
subject, so there is no column for trial. However, we cannot leave the
<code>trial</code> argument unspecified because observations are not
uniquely identified by <code>subject</code> and <code>time</code> alone.
There are instead 2 rows per subject-time combination, one for each
<code>script</code> condition:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cursive_agg_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">timebins</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,092 × 3</span></span></span>
<span><span class="co">#&gt;    subject timebins     n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 10b.edf        0     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 10b.edf      100     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 10b.edf      200     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 10b.edf      300     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 10b.edf      400     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 10b.edf      500     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 10b.edf      600     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 10b.edf      700     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 10b.edf      800     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10b.edf      900     2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,082 more rows</span></span></span></code></pre></div>
<p>Therefore we need a “dummy” column for trial to distinctly mark
“cursive” vs. “script” trials. We save this new data as
<code>cursive_agg</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cursive_agg</span> <span class="op">&lt;-</span> <span class="va">cursive_agg_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>trial_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">script</span>, <span class="st">"_agg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,184 × 6</span></span></span>
<span><span class="co">#&gt;        X subject script  timebins aggbaseline trial_type </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 10b.edf cursive        0      36.9   cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 10b.edf cursive      100      27.5   cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 10b.edf cursive      200      19.6   cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 10b.edf cursive      300      12.6   cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 10b.edf cursive      400       5.60  cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 10b.edf cursive      500       0.968 cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 10b.edf cursive      600      -<span style="color: #BB0000;">5.98</span>  cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 10b.edf cursive      700      -<span style="color: #BB0000;">5.96</span>  cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 10b.edf cursive      800       3.01  cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 10b.edf cursive      900      12.9   cursive_agg</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,174 more rows</span></span></span></code></pre></div>
<p>This makes all observations uniquely identified by the columns for
<code>subject</code>, <code>trial</code>, and <code>time</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cursive_agg</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">timebins</span>, <span class="va">trial_type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;       n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1</span></span></code></pre></div>
<p>The final specification object looks like the following:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cursive_agg_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span>,</span>
<span>  data <span class="op">=</span> <span class="va">cursive_agg</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject"</span>, trial <span class="op">=</span> <span class="st">"trial_type"</span>, time <span class="op">=</span> <span class="st">"timebins"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cursive_agg_spec</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">jlmer specification</span> ───────────────────────────────────────── <span style="color: #0000BB;">&lt;jlmer_spec&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Formula</span>: aggbaseline ~ 1 + scriptprint</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Predictors</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">script</span>: scriptprint</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Groupings</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Subject</span>: subject</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Trial</span>: trial_type</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Time</span>: timebins</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Data</span>:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,184 × 5</span></span></span>
<span><span class="co">#&gt;   aggbaseline scriptprint subject trial_type  timebins</span></span>
<span><span class="co">#&gt;         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        36.9           0 10b.edf cursive_agg        0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        27.5           0 10b.edf cursive_agg      100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>        19.6           0 10b.edf cursive_agg      200</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,181 more rows</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="b-cpa-with-default-statistic-t">B) CPA with default <code>statistic = "t"</code><a class="anchor" aria-label="anchor" href="#b-cpa-with-default-statistic-t"></a>
</h2>
<p>The CPA output from the original tutorial (using 100 simulations) is
copied below for comparison:</p>
<pre><code><span><span class="co">#&gt; #&gt; effect   b0     b1  sign        cms           p</span></span>
<span><span class="co">#&gt; #&gt; script    0    100     1  10.121215   0.1584158</span></span>
<span><span class="co">#&gt; #&gt; script  900   1000    -1  8.756152    0.1782178</span></span>
<span><span class="co">#&gt; #&gt; script 1900   2500     1  82.198279   0.0099010</span></span></code></pre>
<p>Using a threshold of 2 with the default <code>statistic = "t"</code>,
<code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> returns the following:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">cursive_agg_spec</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"t"</span>, <span class="co"># Default value spelled out</span></span>
<span>  threshold <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">scriptprint</span> (n = 100)</span></span>
<span><span class="co">#&gt;   Mean (SD): 0.000 (0.00)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [0.000, 0.000]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">2</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">scriptprint</span></span></span>
<span><span class="co">#&gt;   [2000, 2300]: -8.748 <span style="font-style: italic;">(p=0.0099)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>The results look very different from the original. This is due to the
following:</p>
<ol style="list-style-type: decimal">
<li><p>The cluster-mass statistic (cms) is lower. This is because we ran
<code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> with the default
<code>statistic = "t"</code>.</p></li>
<li><p>Different clusters are identified. This is because our simple
model does not account for subject-level variation, whereas the original
did this with the error term in the formula
<code>aggbaseline ~ script + Error(subject)</code>.</p></li>
<li><p>The sign on the cluster is reversed. This is because the defaults
of <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code> used in the original tutorial are different from
the default contrast coding of our regression model.</p></li>
</ol>
<p>We now address these issue in turn, building up to a CPA that closely
replicate the results of the tutorial.</p>
</div>
<div class="section level2">
<h2 id="c-comparing-t-vs--chisq">C) Comparing “t” vs. “chisq”<a class="anchor" aria-label="anchor" href="#c-comparing-t-vs--chisq"></a>
</h2>
<p>The original tutorial used <code><a href="https://rdrr.io/pkg/clusterperm/man/cluster_nhds.html" class="external-link">clusterperm::cluster_nhds()</a></code>
to conduct a CPA, which fits ANOVA models by time. There, the timewise
statistic used is <strong>chi-squared</strong> and the threshold is
determined from the p-value of the chi-squared statistic.</p>
<p>Using chi-squared statistics with p-value threshold is also supported
in <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> using <code>statistic = "chisq"</code>
(instead of the default <code>"t"</code>):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">cursive_agg_spec</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># Threshold is now the p-value of the chi-squared statistic</span></span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (n = 100, <span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   Mean (SD): 0.000 (0.00)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [0.000, 0.000]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (<span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   [2000, 2300]: -19.085 <span style="font-style: italic;">(p=0.0099)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>This returns the same cluster but now with a numerically larger
cluster-mass statistic, as expected (chi-squared is asymptotic to
t^2).</p>
<p>Below, we compare the shape of the timewise statistics between “t”
with threshold of 2 and “chisq” with threshold of p=0.05:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timewise_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics</a></span><span class="op">(</span><span class="va">cursive_agg_spec</span>, statistic <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span></span>
<span><span class="va">timewise_chisqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics</a></span><span class="op">(</span><span class="va">cursive_agg_spec</span>, statistic <span class="op">=</span> <span class="st">"chisq"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">timewise_fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">statistic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"fixed-t"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">timewise_ts</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"fixed-chisq"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">timewise_chisqs</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">qchisq</a></span><span class="op">(</span><span class="fl">.95</span>, df <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">qchisq</a></span><span class="op">(</span><span class="fl">.95</span>, df <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#00BFC4"</span>, <span class="st">"#F8766D"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed-t"</span>, <span class="st">"fixed-chisq"</span>, <span class="st">"re-intercept-chisq"</span>, <span class="st">"re-max-chisq"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">timewise_fig</span></span></code></pre></div>
<p><img src="Geller-et-al-2020_files/figure-html/timewise-compare-1.png" width="100%"></p>
<p>We find the same clusters identified between 2000ms-2300ms for both
“t” and “chisq”, with the peaks more pronounced for “chisq”. The
differences between the two are inconsequential for this example, but
may produce different results in other cases.</p>
<div class="callout" style="font-size:0.9em">
<p>The chi-squared statistic (which <code>jlmerclusterperm</code>
computes via a likelihood ratio test) is often preferred for testing
single parameters because it makes less assumptions and tend to be more
robust (<a href="https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#model-diagnostics" class="external-link">glmmFAQ</a>).
But because goodness-of-fit tests are at the level of a predictor in a
model formula, “chisq” is less interpretable for multi-level predictors
(k-1 &gt; 1). For teasing apart the contribution of the individual
levels of a multi-level predictor, using <code>statistic = "t"</code> is
more appropriate.</p>
</div>
</div>
<div class="section level2">
<h2 id="d-specifying-random-effects">D) Specifying random effects<a class="anchor" aria-label="anchor" href="#d-specifying-random-effects"></a>
</h2>
<p>The biggest missing component at this point is the subject random
effects, which the original tutorial captures via the error term
<code>Error(subject)</code>. There isn’t a strict equivalent to this in
regression, but specifying random intercepts by subject with
<code>(1 | subject)</code> gets us very close:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cursive_agg_spec_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">cursive_agg</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject"</span>, time <span class="op">=</span> <span class="st">"timebins"</span>, trial <span class="op">=</span> <span class="st">"trial_type"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">re_CPA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>    <span class="va">cursive_agg_spec_re</span>,</span>
<span>    statistic <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.00    0.08    8.12</span></span>
<span><span class="va">re_CPA</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (n = 100, <span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   Mean (SD): 1.132 (12.58)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-21.081, 32.649]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (<span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   [0, 100]: -9.770 <span style="color: #B2B2B2; font-style: italic;">(p=0.1881)</span></span></span>
<span><span class="co">#&gt;   [900, 1000]: 8.521 <span style="color: #B2B2B2; font-style: italic;">(p=0.2475)</span></span></span>
<span><span class="co">#&gt;   [1900, 2500]: -73.440 <span style="font-style: italic;">(p=0.0099)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>We repeat the results from the original tutorial below for
comparison:</p>
<pre><code><span><span class="co">#&gt; #&gt; effect   b0     b1  sign        cms           p</span></span>
<span><span class="co">#&gt; #&gt; script    0    100     1  10.121215   0.1584158</span></span>
<span><span class="co">#&gt; #&gt; script  900   1000    -1  8.756152    0.1782178</span></span>
<span><span class="co">#&gt; #&gt; script 1900   2500     1  82.198279   0.0099010</span></span></code></pre>
<p>We now plot the timewise statistics from the random intercept
models:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timewise_chisqs_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics</a></span><span class="op">(</span><span class="va">cursive_agg_spec_re</span>, statistic <span class="op">=</span> <span class="st">"chisq"</span><span class="op">)</span></span>
<span><span class="va">timewise_fig_re</span> <span class="op">&lt;-</span> <span class="va">timewise_fig</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"re-intercept-chisq"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">timewise_chisqs_re</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">timewise_fig_re</span></span></code></pre></div>
<p><img src="Geller-et-al-2020_files/figure-html/timewise_fig-re-1.png" width="100%"></p>
<p>At this point we may wonder whether the results change much if we
used a maximal model with the random effects structure
<code>(1 + script | subject)</code>. We first create another
specification object with a maximal formula:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cursive_agg_spec_re_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">script</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">cursive_agg</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject"</span>, time <span class="op">=</span> <span class="st">"timebins"</span>, trial <span class="op">=</span> <span class="st">"trial_type"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then compute the timewise statistics:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timewise_chisqs_re_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_timewise_statistics.html">compute_timewise_statistics</a></span><span class="op">(</span><span class="va">cursive_agg_spec_re_max</span>, statistic <span class="op">=</span> <span class="st">"chisq"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="color: #0000BB;">1</span> singular fit (3.85%).</span></span></code></pre></div>
<p>We find that the chisq statistics from the maximal model is virtually
identical to that from the more parsimonious, intercept-only model (the
two lines overlap):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timewise_fig_re</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"re-max-chisq"</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">timewise_chisqs_re_max</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Geller-et-al-2020_files/figure-html/timewise_fig_re2-1.png" width="100%"></p>
<p>Parsimony is incredibly important for simulation - while
<code>jlmerclusterperm</code> is fast, model complexity is still a major
bottleneck. When adding the extra random effect terms (random slope and
correlation) has negligible effects on the statistic, removing them is
likely to be inconsequential for the CPA itself.</p>
<p>We show this in the following CPA run, which uses the maximal model.
Notice how the results are identical to the intercept-only
<code>re_CPA</code> but substantially slower:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">re_max_CPA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>    <span class="va">cursive_agg_spec_re_max</span>,</span>
<span>    statistic <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.01    0.05   12.11</span></span>
<span><span class="va">re_max_CPA</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (n = 100, <span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   Mean (SD): 1.132 (12.58)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-21.081, 32.649]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (<span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   [0, 100]: -9.770 <span style="color: #B2B2B2; font-style: italic;">(p=0.1881)</span></span></span>
<span><span class="co">#&gt;   [900, 1000]: 8.521 <span style="color: #B2B2B2; font-style: italic;">(p=0.2475)</span></span></span>
<span><span class="co">#&gt;   [1900, 2500]: -73.440 <span style="font-style: italic;">(p=0.0099)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>We run the above maximal mixed model CPA purely for demonstration
purposes. The random effects structure is actually unidentifiable given
the aggregated data, where at any point in time there are only 2
observations from each subject (the mean of each condition).</p>
</div>
<p>Lastly, back in our figure of the data, we annotate the clusters
detected with the chisq p-value threshold of 0.05 from the random
intercept CPA:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empirical_clusters_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu"><a href="../reference/extract_empirical_clusters.html">extract_empirical_clusters</a></span><span class="op">(</span><span class="va">timewise_chisqs_re</span>, threshold <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">script_fig</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">start</span>, xend <span class="op">=</span> <span class="va">end</span>, y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>,</span>
<span>      color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">sum_statistic</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">empirical_clusters_df</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, x <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="op">(</span><span class="va">end</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cluster"</span>, <span class="va">id</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">empirical_clusters_df</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sign of cluster"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Geller-et-al-2020_files/figure-html/cluster-annotate-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="e-contrast-coding">E) Contrast coding<a class="anchor" aria-label="anchor" href="#e-contrast-coding"></a>
</h2>
<p>The last piece of the puzzle is the flipped sign of the effect.
Whereas we detect a <em>negative</em> cluster when the line for cursive
is over the line for print, the original tutorial reports a
<em>positive</em> cluster (output repeated below):</p>
<pre><code><span><span class="co">#&gt; #&gt; effect   b0     b1  sign        cms           p</span></span>
<span><span class="co">#&gt; #&gt; script    0    100     1  10.121215   0.1584158</span></span>
<span><span class="co">#&gt; #&gt; script  900   1000    -1  8.756152    0.1782178</span></span>
<span><span class="co">#&gt; #&gt; script 1900   2500     1  82.198279   0.0099010</span></span></code></pre>
<p>Fixing this is trivial - it just takes a different choice of
contrast.</p>
<p>For example, we can flip the levels of the factor to make “print” the
reference level:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rev_contrast_df</span> <span class="op">&lt;-</span> <span class="va">cursive_agg</span></span>
<span><span class="va">rev_contrast_df</span><span class="op">$</span><span class="va">script</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">rev_contrast_df</span><span class="op">$</span><span class="va">script</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"print"</span>, <span class="st">"cursive"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">rev_contrast_df</span><span class="op">$</span><span class="va">script</span><span class="op">)</span></span>
<span><span class="co">#&gt;         cursive</span></span>
<span><span class="co">#&gt; print         0</span></span>
<span><span class="co">#&gt; cursive       1</span></span>
<span><span class="va">reverse_contrast_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">rev_contrast_df</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject"</span>, time <span class="op">=</span> <span class="st">"timebins"</span>, trial <span class="op">=</span> <span class="st">"trial_type"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">reverse_contrast_spec</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (n = 100, <span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   Mean (SD): -1.132 (12.58)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-32.649, 21.081]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (<span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   [0, 100]: 9.770 <span style="color: #B2B2B2; font-style: italic;">(p=0.1881)</span></span></span>
<span><span class="co">#&gt;   [900, 1000]: -8.521 <span style="color: #B2B2B2; font-style: italic;">(p=0.2475)</span></span></span>
<span><span class="co">#&gt;   [1900, 2500]: 73.440 <span style="font-style: italic;">(p=0.0099)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>Or we could also sum-code and set “print” to -1 and “cursive” to
1:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sum_contrast_df</span> <span class="op">&lt;-</span> <span class="va">cursive_agg</span></span>
<span><span class="va">sum_contrast_df</span><span class="op">$</span><span class="va">script</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sum_contrast_df</span><span class="op">$</span><span class="va">script</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">sum_contrast_df</span><span class="op">$</span><span class="va">script</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html" class="external-link">contr.sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">sum_contrast_df</span><span class="op">$</span><span class="va">script</span><span class="op">)</span></span>
<span><span class="co">#&gt;         [,1]</span></span>
<span><span class="co">#&gt; cursive    1</span></span>
<span><span class="co">#&gt; print     -1</span></span>
<span><span class="va">sum_contrast_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">aggbaseline</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">script</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">sum_contrast_df</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"subject"</span>, time <span class="op">=</span> <span class="st">"timebins"</span>, trial <span class="op">=</span> <span class="st">"trial_type"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">sum_contrast_spec</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (n = 100, <span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   Mean (SD): -1.132 (12.58)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-32.649, 21.081]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (<span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   [0, 100]: 9.770 <span style="color: #B2B2B2; font-style: italic;">(p=0.1881)</span></span></span>
<span><span class="co">#&gt;   [900, 1000]: -8.521 <span style="color: #B2B2B2; font-style: italic;">(p=0.2475)</span></span></span>
<span><span class="co">#&gt;   [1900, 2500]: 73.440 <span style="font-style: italic;">(p=0.0099)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>Because CPA operates over the domain of the timewise statistics (and
not the effect size), whether the difference between “print” and
“cursive” is expressed as a unit of 1 (in treatment coding) or 2 (in
contrast coding) has no bearing on the CPA.</p>
</div>
<p>To conclude, we re-run and time a 1000-simulation CPA using the
intercept-only model with the new treatment coding of
<code>script</code> where “print” is the reference level.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">final_CPA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>    <span class="va">reverse_contrast_spec</span>,</span>
<span>    statistic <span class="op">=</span> <span class="st">"chisq"</span>,</span>
<span>    threshold <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;    0.09    0.06   12.41</span></span>
<span><span class="va">final_CPA</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (n = 1000, <span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   Mean (SD): -0.107 (16.50)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-36.966, 41.530]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (chisq p &lt; <span style="color: #0000BB;">0.05</span>) ───────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">script</span> (<span style="font-style: italic;">df = 1</span>)</span></span>
<span><span class="co">#&gt;   [0, 100]: 9.770 <span style="color: #B2B2B2; font-style: italic;">(p=0.2108)</span></span></span>
<span><span class="co">#&gt;   [900, 1000]: -8.521 <span style="color: #B2B2B2; font-style: italic;">(p=0.2358)</span></span></span>
<span><span class="co">#&gt;   [1900, 2500]: 73.440 <span style="font-style: italic;">(p=0.0090)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>Finally, annotating just the significant cluster on the figure:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">signif_clusters_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">final_CPA</span><span class="op">$</span><span class="va">empirical_clusters</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">pvalue</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">signif_clusters_df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   predictor id    start   end length sum_statistic  pvalue</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> script    3      <span style="text-decoration: underline;">1</span>900  <span style="text-decoration: underline;">2</span>500      7          73.4 0.008<span style="text-decoration: underline;">99</span></span></span>
<span><span class="va">script_fig</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">start</span>, xend <span class="op">=</span> <span class="va">end</span>, y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, yend <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"steelblue"</span>, linewidth <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">signif_clusters_df</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, x <span class="op">=</span> <span class="va">start</span> <span class="op">+</span> <span class="op">(</span><span class="va">end</span> <span class="op">-</span> <span class="va">start</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>      label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"p ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">pvalue</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    vjust <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>,</span>
<span>    inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    data <span class="op">=</span> <span class="va">signif_clusters_df</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="Geller-et-al-2020_files/figure-html/final-cluster-vis-1.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://yjunechoe.github.io" class="external-link">June Choe</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
