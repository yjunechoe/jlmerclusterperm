<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Using {future} to run CPA asynchronously in a background process">
<title>Asynchronous CPA â€¢ jlmerclusterperm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Atkinson_Hyperlegible-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Asynchronous CPA">
<meta property="og:description" content="Using {future} to run CPA asynchronously in a background process">
<meta property="og:image" content="https://yjunechoe.github.io/jlmerclusterperm/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jlmerclusterperm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/jlmerclusterperm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Topics</h6>
    <a class="dropdown-item" href="../articles/tidying-output.html">Tidying output</a>
    <a class="dropdown-item" href="../articles/julia-interface.html">Julia interface</a>
    <a class="dropdown-item" href="../articles/reproducibility.html">Reproducibility</a>
    <a class="dropdown-item" href="../articles/asynchronous-cpa.html">Asynchronous CPA</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Case Studies</h6>
    <a class="dropdown-item" href="../articles/Garrison-et-al-2020.html">Garrison et al. 2020</a>
    <a class="dropdown-item" href="../articles/Geller-et-al-2020.html">Geller et al. 2020</a>
    <a class="dropdown-item" href="../articles/deCarvalho-et-al-2021.html">de Carvalho et al. 2021</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/yjunechoe/jlmerclusterperm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Asynchronous CPA</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yjunechoe/jlmerclusterperm/blob/HEAD/vignettes/articles/asynchronous-cpa.Rmd" class="external-link"><code>vignettes/articles/asynchronous-cpa.Rmd</code></a></small>
      <div class="d-none name"><code>asynchronous-cpa.Rmd</code></div>
    </div>

    
    
<p>This vignette showcases using <a href="https://future.futureverse.org" class="external-link">future</a> to run CPA
asynchronously in a background process.</p>
<p>See more tutorials and vignettes on the <a href="https://yjunechoe.github.io/jlmerclusterperm/articles">Articles</a>
page.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Minimal example data and CPA specification:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chickweights</span> <span class="op">&lt;-</span> <span class="va">ChickWeight</span></span>
<span><span class="va">chickweights</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">chickweights</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">chickweights_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Diet</span>,</span>
<span>  data <span class="op">=</span> <span class="va">chickweights</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"Chick"</span>, time <span class="op">=</span> <span class="st">"Time"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Example CPA (1000 simulations):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span><span class="va">CPA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>  <span class="va">chickweights_spec</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>The details of the actual CPA is skipped because thatâ€™s not the focus
of this vignette, but this is the same example from the <a href="https://github.com/yjunechoe/jlmerclusterperm/blob/main/README.md" class="external-link">readme</a>
just with more <code>nsim</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-idea">Basic idea<a class="anchor" aria-label="anchor" href="#basic-idea"></a>
</h2>
<p>The basic idea behind this asynchronous CPA strategy is to start a
background R process whose sole job is to send the instructions for CPA
over to Julia. Itâ€™s <strong>asynchronous</strong> because running the
CPA this way <strong>will not block your interactive R session</strong>.
Since most of the work is being done in Julia anyways, this
parallelization has virtually no impact on the performance of evaluating
R code.</p>
<p>The <a href="https://future.futureverse.org" class="external-link">future</a> package allows such asynchronous evaluation
of R code. Itâ€™s a big package implementing a complex topic. You can read
more about the project on the <a href="https://www.futureverse.org/" class="external-link">futureverse</a> but we just show the
bare minimum here.</p>
<p>For more advanced users, note that weâ€™re use parallelization
<em>only</em> for its asynchronous properties (non-blocking evaluation
of R code in a background process). It is not recommended to start
<em>multiple R processes</em> with each running a CPA because the Julia
session is shared and already multithreaded (if you can spare more
cores, set that in <code>options("jlmerclusterperm.nthreads")</code>
before calling <code><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup()</a></code>).</p>
<p>Later updates to <code>jlmerclusterperm</code> may wrap this workflow
in a more principled way, but for now this vignette serves as a
minimally working example for asynchronously running a CPA.</p>
</div>
<div class="section level2">
<h2 id="walkthrough">Walkthrough<a class="anchor" aria-label="anchor" href="#walkthrough"></a>
</h2>
<div class="section level3">
<h3 id="setup-for-async-cpa">Setup for async CPA<a class="anchor" aria-label="anchor" href="#setup-for-async-cpa"></a>
</h3>
<p>Three things are in order for this workflow:</p>
<ol style="list-style-type: decimal">
<li>Load the <a href="https://future.futureverse.org" class="external-link">future</a> package</li>
<li>Initialize the <code>multisession</code> future</li>
<li>Grab options from the <code>jlmerclusterperm</code> package
environment</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span>
<span><span class="va">pkgopts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu">jlmerclusterperm</span><span class="fu">:::</span><span class="va">.jlmerclusterperm</span><span class="op">)</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>Please treat the <code>.jlmerclusterperm</code> internal variable as
a read-only object - itâ€™s unexported and not meant to be
manipulated.</p>
</div>
</div>
<div class="section level3">
<h3 id="creating-the-future-object">Creating the future object<a class="anchor" aria-label="anchor" href="#creating-the-future-object"></a>
</h3>
<p>We start by creating a special object of class
<code>&lt;Future&gt;</code> using <code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future()</a></code>. We can
simply pass the <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> code to the first argument
of <code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future()</a></code>, but with a slight modification to ensure that
the background process connects to the same Julia session.</p>
<p>The template is as follows. First, you make the <code>pkgopts</code>
object (defined above) available for the future (via the
<code>globals</code> argument). Then, inside the future expression
ensure that the background process shares the same Julia session (via
<code>list2env(...)</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not run</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/future.html" class="external-link">future</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="va">pkgopts</span>, <span class="fu">jlmerclusterperm</span><span class="fu">:::</span><span class="va">.jlmerclusterperm</span><span class="op">)</span></span>
<span>    <span class="co">## Your CPA code below ##</span></span>
<span>  <span class="op">}</span>,</span>
<span>  globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="cn">TRUE</span>, add <span class="op">=</span> <span class="st">"pkgopts"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A future object replicating the 1000-simulation CPA from above will
look like the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.futureverse.org/reference/future.html" class="external-link">future</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list2env.html" class="external-link">list2env</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">pkgopts</span><span class="op">)</span>, <span class="fu">jlmerclusterperm</span><span class="fu">:::</span><span class="va">.jlmerclusterperm</span><span class="op">)</span></span>
<span>    <span class="co">## Your CPA code below ##</span></span>
<span>    <span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span></span>
<span>      <span class="va">chickweights_spec</span>,</span>
<span>      threshold <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>      nsim <span class="op">=</span> <span class="fl">1000</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="cn">TRUE</span>, add <span class="op">=</span> <span class="st">"pkgopts"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Once the future is created, it <strong>immediately</strong> starts
executing the code in a background process. It is important that you
<strong>do not evaluate the future object (<code>f</code>)
directly</strong>. Instead, you should query it with
<code><a href="https://future.futureverse.org/reference/resolved.html" class="external-link">future::resolved()</a></code> - this simply tells you whether the
background evaluation has completed or not:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/resolved.html" class="external-link">resolved</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Here, we use a <code>while</code> loop to show that the background
CPA is non-blocking. We are evaluating R code in the interactive session
<em>simultaneously</em> as the CPA is running:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">while</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://future.futureverse.org/reference/resolved.html" class="external-link">resolved</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Elapsed: %.01fs"</span>, <span class="va">i</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Elapsed: 0.5s </span></span>
<span><span class="co">#&gt; Elapsed: 1.0s </span></span>
<span><span class="co">#&gt; Elapsed: 1.5s </span></span>
<span><span class="co">#&gt; Elapsed: 2.0s</span></span></code></pre></div>
<p>We reach the end of the while loop at 2 seconds, which is
approximately how long the CPA took to complete (we confirm this in the
next section). At this point the future has completed and its result is
available for collection.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/resolved.html" class="external-link">resolved</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>Although the R code here was just a crude progress alert using
<code><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep()</a></code>, you can freely evaluate <em>any</em> R code
<strong>except other functions that call Julia</strong>. You can make
plots, clean data, write up analyses, etc., but just donâ€™t run another
CPA while one is already running because the Julia process is
shared.</p>
</div>
</div>
<div class="section level3">
<h3 id="collecting-the-results">Collecting the results<a class="anchor" aria-label="anchor" href="#collecting-the-results"></a>
</h3>
<p>We can collect the output of the background process with
<code><a href="https://future.futureverse.org/reference/value.html" class="external-link">future::value()</a></code>. But first, we double check to make sure
that the background process has indeed finished evaluating:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/resolved.html" class="external-link">resolved</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Once thatâ€™s confirmed, we can use <code><a href="https://future.futureverse.org/reference/value.html" class="external-link">value()</a></code> to collect the
results from the future and assign it to a variable for further
inspection:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPA_async</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://future.futureverse.org/reference/value.html" class="external-link">value</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; Connecting to Julia TCP server at localhost:11980 ...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Detecting empirical clusters and calculating cluster-mass statistics.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">âœ”</span> Detecting empirical clusters and calculating cluster-mass statistics. <span style="color: #B2B2B2;">[63ms]</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Sampling cluster-mass statistics from a bootstrapped null distribution.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">âœ”</span> Sampling cluster-mass statistics from a bootstrapped null distribution. <span style="color: #B2B2B2;">[1.5s]</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Calculating the probability of the observed cluster-mass statistics.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">âœ”</span> Calculating the probability of the observed cluster-mass statistics. <span style="color: #B2B2B2;">[19ms]</span></span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Note how <code><a href="https://future.futureverse.org/reference/value.html" class="external-link">value()</a></code> also prints the messages encountered
while executing the CPA code. We see this because we did not specify
<code>progress = FALSE</code> in the <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> call
passed to the future. For our purposes, just note that adding up the
times from the messages is similar to what we saw from the while loop (2
seconds).</p>
<p>The output of the asynchronous CPA (<code>CPA_async</code>) is
identical to the initial CPA that we ran at the beginning
(<code>CPA</code>) because both were ran with the default seed of 1 and
the RNG counter value of <code>123L</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">CPA_async</span>, <span class="va">CPA</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>A separate vignette covers the <a href="https://yjunechoe.github.io/jlmerclusterperm/articles/reproducibility.html">Julia
RNG</a>.</p>
</div>
<p>In practice, you may want to use a random seed (via
<code><a href="../reference/julia_rng.html">set_rng_seed()</a></code>) for the background CPA.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://yjunechoe.github.io" class="external-link">June Choe</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
