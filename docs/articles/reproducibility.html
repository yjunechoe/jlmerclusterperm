<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Using RNG seed and counter state to guarantee reproducibility of results">
<title>Reproducibility • jlmerclusterperm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Atkinson_Hyperlegible-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Reproducibility">
<meta property="og:description" content="Using RNG seed and counter state to guarantee reproducibility of results">
<meta property="og:image" content="https://yjunechoe.github.io/jlmerclusterperm/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">jlmerclusterperm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/jlmerclusterperm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Topics</h6>
    <a class="dropdown-item" href="../articles/tidying-output.html">Tidying output</a>
    <a class="dropdown-item" href="../articles/julia-interface.html">Julia interface</a>
    <a class="dropdown-item" href="../articles/reproducibility.html">Reproducibility</a>
    <a class="dropdown-item" href="../articles/asynchronous-cpa.html">Asynchronous CPA</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Case Studies</h6>
    <a class="dropdown-item" href="../articles/Garrison-et-al-2020.html">Garrison et al. 2020</a>
    <a class="dropdown-item" href="../articles/Geller-et-al-2020.html">Geller et al. 2020</a>
    <a class="dropdown-item" href="../articles/deCarvalho-et-al-2021.html">de Carvalho et al. 2021</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/yjunechoe/jlmerclusterperm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reproducibility</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yjunechoe/jlmerclusterperm/blob/HEAD/vignettes/articles/reproducibility.Rmd" class="external-link"><code>vignettes/articles/reproducibility.Rmd</code></a></small>
      <div class="d-none name"><code>reproducibility.Rmd</code></div>
    </div>

    
    
<p>This vignette showcases using RNG seed and counter state to guarantee
the reproducibility of results from <a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a>.</p>
<p>See more tutorials and vignettes on the <a href="https://yjunechoe.github.io/jlmerclusterperm/articles">Articles</a>
page.</p>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Minimal example data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">chickweights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">ChickWeight</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diet <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html" class="external-link">fct_collapse</a></span><span class="op">(</span><span class="va">Diet</span>, A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">chickweights</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Time</span>, <span class="va">weight</span>, color <span class="op">=</span> <span class="va">diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>fun.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="fl">1.96</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html" class="external-link">stat_summary</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span></code></pre></div>
<p><img src="reproducibility_files/figure-html/MWE-setup-1.png" width="100%"></p>
<p>The jlmer specification object used for this showcase:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jlmer_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_jlmer_spec.html">make_jlmer_spec</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">diet</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Chick</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">chickweights</span>,</span>
<span>  subject <span class="op">=</span> <span class="st">"Chick"</span>, time <span class="op">=</span> <span class="st">"Time"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">jlmer_spec</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">jlmer specification</span> ───────────────────────────────────────── <span style="color: #0000BB;">&lt;jlmer_spec&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Formula</span>: weight ~ 1 + dietB + (1 | Chick)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Predictors</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">diet</span>: dietB</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Groupings</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Subject</span>: Chick</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Trial</span>:</span></span>
<span><span class="co">#&gt;   <span style="font-style: italic;">Time</span>: Time</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Data</span>:</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 533 × 4</span></span></span>
<span><span class="co">#&gt;   weight dietB Chick  Time</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     42     0 1         0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     51     0 1         2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     59     0 1         4</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 530 more rows</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rng-seed-vs--counter">RNG seed vs. counter<a class="anchor" aria-label="anchor" href="#rng-seed-vs--counter"></a>
</h2>
<p>Because CPA is powered by bootstrapping, it is inherently a
stochastic procedure. Reproducibility is guaranteed for
<code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> calls ran with the same
<strong>seed</strong> and <strong>counter</strong> values. These are
both properties of the Julia random number generator used by
<a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a> and refer to two slightly different
concepts:</p>
<ol style="list-style-type: decimal">
<li><p>The <strong>seed</strong> is conceptually equivalent to the same
“seed” as talked about in R, as in <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>. The seed is
used in the RNG’s initialization, locking it into a specific state that
persists for the session. In <a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a>, the
default seed is <code>1</code> and is primarily controlled via
<code>options("jlmerclusterperm.seed")</code> which must be set
<em>before</em> calling <code><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup()</a></code>.</p></li>
<li><p>The <strong>counter</strong> initializes to <code>0</code> and
increments by some value every time the RNG is consumed to produce a
random number. There is no equivalent concept in base R, though it’s a
more handy and intuitive way of interfacing with the RNG’s state in an
interactive session. The counter can be manipulated via the functions
<code><a href="../reference/julia_rng.html">reset_rng_state()</a></code>, <code><a href="../reference/julia_rng.html">set_rng_state()</a></code>, and
<code><a href="../reference/julia_rng.html">get_rng_state()</a></code>.</p></li>
</ol>
<p>The rest of this vignette will showcase interacting with the
<strong>counter</strong> state, as it is more useful in practice.</p>
</div>
<div class="section level2">
<h2 id="behavior-of-rng-counter">Behavior of RNG counter<a class="anchor" aria-label="anchor" href="#behavior-of-rng-counter"></a>
</h2>
<p>At the start of a fresh session, the counter is initialized at zero.
And because we did not specify the seed, it’s at one:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_seed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>We start with a simple <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> with 100
simulations. The reproducibility profile of this run has a seed of
<code>1</code> and a counter of <code>0</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPA_1_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, threshold <span class="op">=</span> <span class="fl">1</span>, nsim <span class="op">=</span> <span class="fl">100</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">CPA_1_0</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">1</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dietB</span> (n = 100)</span></span>
<span><span class="co">#&gt;   Mean (SD): 0.724 (5.54)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-10.847, 12.592]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">1</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dietB</span></span></span>
<span><span class="co">#&gt;   [2, 14]: 18.231 <span style="font-style: italic;">(p=0.0198)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>After this run, the counter is now incremented to 3712:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3712</span></span></code></pre></div>
<p>The same call to <code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> now runs with this new
counter value, and it produces a different result. Again, this is
expected given the stochastic nature of the CPA (and thus the need to
run tens of thousands of simulations when reporting results):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CPA_1_3712</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, threshold <span class="op">=</span> <span class="fl">1</span>, nsim <span class="op">=</span> <span class="fl">100</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">CPA_1_3712</span></span>
<span><span class="co">#&gt; $null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">1</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dietB</span> (n = 100)</span></span>
<span><span class="co">#&gt;   Mean (SD): -0.618 (8.51)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-18.328, 19.076]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $empirical_clusters</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Empirical clusters</span> (t &gt; <span style="color: #0000BB;">1</span>) ────────────────────────── <span style="color: #0000BB;">&lt;empirical_clusters&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dietB</span></span></span>
<span><span class="co">#&gt;   [2, 14]: 18.231 <span style="color: #B2B2B2; font-style: italic;">(p=0.0792)</span></span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span></code></pre></div>
<p>This second run also increments the counter state, but note how it’s
<em>not exactly</em> by the same amount (this is not possible to
predict):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7427</span></span></code></pre></div>
<p>The difference between these two runs is specifically in the
<strong>null distribution</strong> of the cluster-mass statistics. Both
100-simulation samples are drawn share the same underlying (null)
distribution, though they are not identical to one another (they rarely
are).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sum_statistic</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">CPA_1_0</span><span class="op">$</span><span class="va">null_cluster_dists</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"3712"</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">CPA_1_3712</span><span class="op">$</span><span class="va">null_cluster_dists</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span><span class="st">"Counter"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reproducibility_files/figure-html/null_dist_plot-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="manipulating-rng-counter">Manipulating RNG counter<a class="anchor" aria-label="anchor" href="#manipulating-rng-counter"></a>
</h2>
<p>Using <code>set_rng_counter()</code>, it is possible to reproduce a
prior run. For example, to reproduce the second
<code><a href="../reference/clusterpermute.html">clusterpermute()</a></code> call, we set the counter back to 3712 with
<code><a href="../reference/julia_rng.html">set_rng_state()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">3712</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3712</span></span></code></pre></div>
<p>The results of the subsequent run from this counter state is
identical to the previous run:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>  <span class="va">CPA_1_3712</span>,</span>
<span>  <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, threshold <span class="op">=</span> <span class="fl">1</span>, nsim <span class="op">=</span> <span class="fl">100</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>To reproduce the first CPA ran with counter at <code>0</code>, we can
again use <code><a href="../reference/julia_rng.html">set_rng_state()</a></code> or simply use
<code><a href="../reference/julia_rng.html">reset_rng_state()</a></code> which is an alias for
<code>set_rng_state(0)</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">reset_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>  <span class="va">CPA_1_0</span>,</span>
<span>  <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, threshold <span class="op">=</span> <span class="fl">1</span>, nsim <span class="op">=</span> <span class="fl">100</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>This behavior can be observed at the specific step of simulating the
null distribution as well. The function corresponding to this step is
<code><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics()</a></code> and we run 100 simulations
for this step with counter at zero:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/julia_rng.html">reset_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="va">null_statistics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, nsim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3712</span></span></code></pre></div>
<p>Running the cluster detection algorithm over the result using
<code><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists()</a></code> returns a null cluster-mass
distribution which is identical to that from <code>CPA_1_0</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">null_cluster_dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists</a></span><span class="op">(</span><span class="va">null_statistics</span>, threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">null_cluster_dists</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Null cluster-mass distribution</span> (t &gt; <span style="color: #0000BB;">1</span>) ────────────── <span style="color: #0000BB;">&lt;null_cluster_dists&gt;</span> ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">dietB</span> (n = 100)</span></span>
<span><span class="co">#&gt;   Mean (SD): 0.724 (5.54)</span></span>
<span><span class="co">#&gt;   Coverage intervals: 95% [-10.847, 12.592]</span></span>
<span><span class="co">#&gt; ────────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">null_cluster_dists</span>, <span class="va">CPA_1_0</span><span class="op">$</span><span class="va">null_cluster_dists</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="technical-details-and-notes">Technical details and notes<a class="anchor" aria-label="anchor" href="#technical-details-and-notes"></a>
</h2>
<p>The Julia back-end uses a thread-safe, counter-based RNG called <a href="https://juliarandom.github.io/RandomNumbers.jl/stable/man/random123/#threefry" class="external-link">Threefry</a>
(specifically, <code>Random123.Threefry2x</code>) which comes from the
<a href="https://juliarandom.github.io/RandomNumbers.jl/stable/man/random123/" class="external-link">Random123.jl</a>
Julia library as an adaptation of the original algorithm developed by <a href="http://dx.doi.org/10.1145/2063384.2063405" class="external-link">Salmon, Moraes, Dror,
and Shaw (2011)</a>. The RNG is initialized with a “rounds” value of 20,
which is also the default. Threefry is used for its speed and stability
across Julia versions.</p>
<p>Additionally, as noted earlier, the RNG initializes with an explicit
seed of <code>1</code>. This behavior is different than in the case of
R, where a random seed is chosen for the user for every new session. The
consequence is that in the absence of explicit seeding via
<code>options("jlmerclusterperm.seed")</code>, the first run of every
new session (i.e., runs with counter value of zero) will be
identical.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Restart Julia session</span></span>
<span><span class="fu"><a href="../reference/jlmerclusterperm_setup.html">jlmerclusterperm_setup</a></span><span class="op">(</span>restart <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RNG seed is again 1</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_seed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># So results of the first CPA of the session (with counter = 0) is the same</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">get_rng_state</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span></span>
<span>  <span class="va">CPA_1_0</span>,</span>
<span>  <span class="fu"><a href="../reference/clusterpermute.html">clusterpermute</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, threshold <span class="op">=</span> <span class="fl">1</span>, nsim <span class="op">=</span> <span class="fl">100</span>, progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="callout" style="font-size:0.9em">
<p>Given the interface to the RNG counter, there are not many unique
advantages to using a different seed over manipulating the RNG counter.
But an interface to RNG seed is also provided via
<code><a href="../reference/julia_rng.html">set_rng_seed()</a></code> and <code><a href="../reference/julia_rng.html">get_rng_seed()</a></code>.</p>
</div>
<p>Lastly, please be aware that changing the seed for the <em>R
session</em> (e.g., via <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code>) has no effect on
<a href="https://github.com/yjunechoe/jlmerclusterperm" class="external-link">jlmerclusterperm</a> functions powered by the <em>Julia</em>
back-end.</p>
</div>
<div class="section level2">
<h2 id="miscellaneous">Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"></a>
</h2>
<p>You may be wondering whether two CPAs that overlap in the range of
counter values also share overlapping samples from the null. This is
actually not the case in practice because of how shuffling for the CPA
is implemented:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 100 simulations of timewise statistics</span></span>
<span><span class="co">## First CPA using counter at 1</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, nsim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">## Second CPA using counter at 2</span></span>
<span><span class="fu"><a href="../reference/julia_rng.html">set_rng_state</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/permute_timewise_statistics.html">permute_timewise_statistics</a></span><span class="op">(</span><span class="va">jlmer_spec</span>, nsim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The null cluster-mass statistics</span></span>
<span><span class="va">x_null</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists</a></span><span class="op">(</span><span class="va">x</span>, threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_null_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">x_null</span><span class="op">)</span><span class="op">$</span><span class="va">sum_statistic</span></span>
<span><span class="va">y_null</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_null_cluster_dists.html">extract_null_cluster_dists</a></span><span class="op">(</span><span class="va">y</span>, threshold <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">y_null_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">y_null</span><span class="op">)</span><span class="op">$</span><span class="va">sum_statistic</span></span>
<span></span>
<span><span class="co"># Relationship between two CPAs with similar initial counters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x_null_stats</span>, <span class="va">y_null_stats</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="reproducibility_files/figure-html/similar-counter-1.png" width="100%"></p>
<div class="callout" style="font-size:0.9em">
<p>The two colored lines represent two 100-simulation bootstrap
permutations that differ in the initial RNG counter by a value of 1. The
point is that the shape of the two lines look very different - one is
not just the shifted form of another.</p>
</div>
<p>For more formal investigations (e.g., when simulating power for CPA),
it’s of course best practice to generate random <em>seeds</em>. The
<em>counter</em> is more of a convenience that balances interactivity
with reproducibility.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://yjunechoe.github.io" class="external-link">June Choe</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
